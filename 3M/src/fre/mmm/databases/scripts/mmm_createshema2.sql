CREATE SCHEMA MMM;

CREATE TABLE T_USERS ( 
	ID_USER              integer GENERATED ALWAYS AS IDENTITY  NOT NULL,
	USER_LOGIN           varchar(100)   ,
	USER_FIRSTNAME       varchar   NOT NULL,
	USER_LASTNAME        varchar   NOT NULL,
	USER_EMAIL           varchar   NOT NULL,
	USER_PHONE           varchar   NOT NULL,
	USER_COMP            varchar   ,
	IS_STAFFER           boolean   ,
	CONSTRAINT PK_T_USERS PRIMARY KEY ( ID_USER ),
	CONSTRAINT PK_T_USERS_0 UNIQUE ( USER_FIRSTNAME ) 
 );

CREATE TABLE T_ACTIONS ( 
	ID_ACTION            integer GENERATED ALWAYS AS IDENTITY  NOT NULL,
	ID_USERRESP_CTU      integer   ,
	ID_USERRESP_AIV      integer   ,
	ACTION_NAME          varchar(100)   NOT NULL,
	ACTION_NUM           varchar   NOT NULL,
	DESCRIPTION          varchar   ,
	COLLAB_LINK          varchar   ,
	NB_JOURS_ESTIME      integer   ,
	NB_JOURS_CTU         float   ,
	NB_JOURS_AIV         float   ,
	PRICE                float   ,
	DOCUMENT_LINK        varchar   ,
	ACTION_ANALYSE       varchar   ,
	ACTION_RESPONSE      varchar   ,
	ID_USER              integer   NOT NULL,
	ACTION_STATUS        varchar(100)   ,
	IS_DESTROYED         boolean   ,
	CONSTRAINT PK_T_ACTIONS PRIMARY KEY ( ID_ACTION ),
	CONSTRAINT PK_T_ACTIONS_0 UNIQUE ( ACTION_NAME ) 
 );

CREATE INDEX IDX_T_ACTIONS ON T_ACTIONS ( ID_USERRESP_CTU );

CREATE INDEX IDX_T_ACTIONS_0 ON T_ACTIONS ( ID_USERRESP_AIV );

CREATE TABLE T_CONGES ( 
	ID_CONGES            integer GENERATED ALWAYS AS IDENTITY  NOT NULL,
	ID_USER              integer   NOT NULL,
	DATE_BEGIN           date   ,
	DATE_END             date   ,
	CONSTRAINT PK_T_CONGES PRIMARY KEY ( ID_CONGES )
 );

CREATE INDEX IDX_T_CONGES ON T_CONGES ( ID_USER );

CREATE TABLE T_PROJET ( 
	ID_PROJET            integer GENERATED ALWAYS AS IDENTITY  NOT NULL,
	ID_USER              integer   NOT NULL,
	PROJECT_NAME         varchar(100)   NOT NULL,
	PROJECT_NUM          varchar   ,
	IS_DESTROYED         boolean   ,
	CONSTRAINT PK_T_PROJET PRIMARY KEY ( ID_PROJET )
 );

CREATE INDEX IDX_T_PROJET ON T_PROJET ( ID_USER );

CREATE TABLE T_WORKER ( 
	ID_USER              integer   NOT NULL,
	ID_PROJET            integer   NOT NULL
 );

CREATE INDEX IDX_T_WORKER ON T_WORKER ( ID_USER );

CREATE INDEX IDX_T_WORKER_0 ON T_WORKER ( ID_PROJET );

CREATE TABLE T_LIVRABLE ( 
	ID_LIVRABLE          integer GENERATED ALWAYS AS IDENTITY  NOT NULL,
	ID_PROJET            integer   NOT NULL,
	LIV_NAME             varchar(100)   NOT NULL,
	LIV_NUM              varchar(100)   NOT NULL,
	NB_JOURS_CTU         float   ,
	NB_JOURS_AIV         float   ,
	COUT_TOTAL           float   ,
	LIV_TYPE             varchar(100)   NOT NULL,
	DATE_LIV             date   NOT NULL,
	LIV_VERSION          integer   ,
	LIV_STATUS           varchar(1)   ,
	IS_DESTROYED         boolean   ,
	CONSTRAINT PK_T_LIVRABLE PRIMARY KEY ( ID_LIVRABLE ),
	CONSTRAINT PK_T_LIVRABLE_0 UNIQUE ( LIV_NAME ) 
 );

CREATE INDEX IDX_T_LIVRABLE ON T_LIVRABLE ( ID_PROJET );

CREATE TABLE T_REGROUPE ( 
	ID_ACTION            integer   NOT NULL,
	ID_LIVRABLE          integer   NOT NULL
 );

CREATE INDEX IDX_T_REGROUPE ON T_REGROUPE ( ID_ACTION );

CREATE INDEX IDX_T_REGROUPE_0 ON T_REGROUPE ( ID_LIVRABLE );

ALTER TABLE T_ACTIONS ADD CONSTRAINT FK_T_ACTIONS_T_USERS_CTU FOREIGN KEY ( ID_USERRESP_CTU ) REFERENCES T_USERS( ID_USER ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE T_ACTIONS ADD CONSTRAINT FK_T_ACTIONS_T_USERS_AIV FOREIGN KEY ( ID_USERRESP_AIV ) REFERENCES T_USERS( ID_USER ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE T_CONGES ADD CONSTRAINT FK_T_CONGES FOREIGN KEY ( ID_USER ) REFERENCES T_USERS( ID_USER ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE T_LIVRABLE ADD CONSTRAINT FK_T_LIVRABLE FOREIGN KEY ( ID_PROJET ) REFERENCES T_PROJET( ID_PROJET ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE T_PROJET ADD CONSTRAINT FK_T_PROJET FOREIGN KEY ( ID_USER ) REFERENCES T_USERS( ID_USER ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE T_REGROUPE ADD CONSTRAINT FK_T_REGROUPE FOREIGN KEY ( ID_ACTION ) REFERENCES T_ACTIONS( ID_ACTION ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE T_REGROUPE ADD CONSTRAINT FK_T_REGROUPE_0 FOREIGN KEY ( ID_LIVRABLE ) REFERENCES T_LIVRABLE( ID_LIVRABLE ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE T_WORKER ADD CONSTRAINT FK_T_WORKER FOREIGN KEY ( ID_USER ) REFERENCES T_USERS( ID_USER ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE T_WORKER ADD CONSTRAINT FK_T_WORKER_0 FOREIGN KEY ( ID_PROJET ) REFERENCES T_PROJET( ID_PROJET ) ON DELETE NO ACTION ON UPDATE NO ACTION;

